<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem E-Tempah Bilik Khas SKTK</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#0f172a',
              secondary: '#1e293b',
              accent: '#3b82f6',
            }
          }
        }
      }
    </script>
    
    <!-- Babel for in-browser compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Import Map for dependencies -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "date-fns": "https://esm.sh/date-fns@2.30.0",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-[#0b1120] text-gray-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useCallback } from 'react';
        import { createRoot } from 'react-dom/client';
        import { format, addDays, startOfWeek, subWeeks, addWeeks, isSameWeek, startOfToday, isSameDay } from 'date-fns';
        import { ChevronLeft, ChevronRight, Monitor, Film, Users, Info, Loader2, Database, Lock, X, CalendarPlus, AlertTriangle } from 'lucide-react';

        // --- TYPES & DATA ---
        const RoomType = {
            MAKMAL_KOMPUTER: 'MAKMAL KOMPUTER',
            BILIK_TAYANGAN: 'BILIK TAYANGAN',
            BILIK_MESYUARAT: 'BILIK MESYUARAT'
        };

        const DayOfWeek = {
            ISNIN: 'ISNIN',
            SELASA: 'SELASA',
            RABU: 'RABU',
            KHAMIS: 'KHAMIS',
            JUMAAT: 'JUMAAT'
        };

        // --- KONFIGURASI ---
        const API_URL = "https://script.google.com/macros/s/AKfycbw4Vnf9wjmoTLI3CsluFooq8g0wioJS6Uyyo38MVIuzAmQxiK3ProSUTOaQFe0xdOpJeg/exec"; 

        const ROOMS = [
            RoomType.MAKMAL_KOMPUTER,
            RoomType.BILIK_TAYANGAN,
            RoomType.BILIK_MESYUARAT
        ];

        const CLASSES = [
            { name: '1 AL-IKHLAS' }, { name: '1 AL-FALAQ' }, { name: '1 AN-NAS' },
            { name: '2 AL-IKHLAS' }, { name: '2 AL-FALAQ' }, { name: '2 AN-NAS' },
            { name: '3 AL-IKHLAS' }, { name: '3 AL-FALAQ' },
            { name: '4 AL-IKHLAS' }, { name: '4 AL-FALAQ' }, { name: '4 AN-NAS' },
            { name: '5 AL-IKHLAS' }, { name: '5 AL-FALAQ' },
            { name: '6 AL-IKHLAS' }, { name: '6 AL-FALAQ' }, { name: '6 AN-NAS' },
        ];

        const TEACHERS = [
            { name: 'NOR EAZAH BINTI ITHNIN' },
            { name: 'SITI SANISAH BINTI HUSAIN' },
            { name: 'FARIDAH BINTI HAMZAH' },
            { name: 'MAZIAH BINTI MUHAMMAD' },
            { name: 'AMIRUL FAHMI BIN YUSUP' },
            { name: 'AQEELA BINTI ALIAH' },
            { name: 'ELIANE BINTI AZMI' },
            { name: 'EMYLIA FARHAN BINTI MOHAMAD YUSOF' },
            { name: 'FALIZAH BINTI MOHAMAD ARSHAD' },
            { name: 'HAYATI BINTI RAMLI' },
            { name: 'IDAHTUL ARRSHYUL NAâ€™AIEM BINTI ABDUL RAHMAN' },
            { name: 'KHAIRUL HAFFIZ BIN AZIZAN' },
            { name: 'MAHANUM BINTI MOKHTAR' },
            { name: 'MAZNAH BINTI KAMARUDDIN' },
            { name: 'MOHD MUZAMER BIN ZAINODDIN' },
            { name: 'MOHD ZAHARI BIN ISHAK' },
            { name: 'MUHAMAD ANAS BIN MOHD AMRAN' },
            { name: 'NADHATUL AKMA BINTI ZAINAL' },
            { name: 'NAIMAH BINTI MOHD NOH' },
            { name: 'NOOR HAFIZAH BINTI OTHMAN' },
            { name: 'NOORSUZANA BINTI NORDIN' },
            { name: 'NOR AZIDAH BINTI MOHAMAD' },
            { name: 'NOR MAIZANNI BINTI KHALIDI' },
            { name: 'NORAIN BINTI ISMAIL' },
            { name: 'NORYANA BINTI ABDUL RAZAK' },
            { name: 'NORZITA BINTI MAKHTAR' },
            { name: 'NURUL ASHIKIN BINTI KHALIDI' },
            { name: 'NURUL HUSNA BINTI ISMAIL' },
            { name: 'NURUL SYAZWANI BINTI MD BASRI' },
            { name: 'ROHAIDA BINTI MD ALI' },
            { name: 'ROHAYA BINTI IBERAHIM' },
            { name: 'ROSLAN BIN IBRAHIM' },
            { name: 'ROZAINI BT TAJON AROS' },
            { name: 'SITI BALQIS BINTI ABDUL RAJI' },
            { name: 'SITI MARHAMAH BINTI MUHAMMAD' },
            { name: 'SITI ZAHARAH BINTI ISHAK' },
        ];

        const TIME_SLOTS = [
            { label: '7.40-8.10', id: '1' },
            { label: '8.10-8.40', id: '2' },
            { label: '8.40-9.10', id: '3' },
            { label: '9.10-10.10', id: '4' },
            { label: '10.10-10.30', id: '5 (REHAT)' },
            { label: '10.30-11.00', id: '6' },
            { label: '11.00-11.30', id: '7' },
            { label: '11.30-12.00', id: '8' },
            { label: '12.00-12.30', id: '9' },
            { label: '12.30-1.00', id: '10' },
            { label: '1.00-1.30', id: '11' },
        ];

        const SUBJECTS = [
            { code: 'BM' }, { code: 'BI' }, { code: 'MT' }, { code: 'SN' },
            { code: 'SJ' }, { code: 'BA' }, { code: 'PI' }, { code: 'JW' },
            { code: 'ULM' }, { code: 'TS' }, { code: 'PS' }, { code: 'MZ' },
            { code: 'PJ' }, { code: 'PK' }, { code: 'RBT' },
        ];

        // --- SERVICES ---
        const getBookings = async () => {
            if (API_URL.includes("MASUKKAN_URL")) {
                console.warn("API URL not configured properly.");
                return [];
            }
            try {
                const response = await fetch(`${API_URL}?action=get_bookings`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                return Array.isArray(data) ? data : [];
            } catch (error) {
                console.error('Error fetching bookings:', error);
                return [];
            }
        };

        const saveBooking = async (booking) => {
            if (API_URL.includes("MASUKKAN_URL")) {
                alert("URL API tidak sah.");
                return false;
            }
            try {
                const response = await fetch(`${API_URL}?action=create_booking`, {
                    method: 'POST',
                    body: JSON.stringify(booking),
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                });
                const result = await response.json();
                return result.status === 'success';
            } catch (error) {
                console.error('Error saving booking:', error);
                return false;
            }
        };

        // --- COMPONENTS ---

        const Header = () => {
            return (
                <header className="bg-white/5 backdrop-blur-md border-b border-white/10 p-6 flex flex-col items-center justify-center text-center shadow-lg relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-400 via-purple-500 to-blue-400"></div>
                    <div className="flex flex-col md:flex-row items-center gap-4 md:gap-8 z-10">
                        <div className="bg-white rounded-full p-2 shadow-xl">
                            <img 
                                src="https://i.postimg.cc/85t7Jtgb/LOGO-SEKOLAH-SKTK-removebg-preview.png" 
                                alt="Logo SKTK" 
                                className="w-24 h-24 md:w-32 md:h-32 object-contain"
                            />
                        </div>
                        <div className="flex flex-col items-center md:items-start text-white">
                            <h1 className="text-2xl md:text-3xl font-bold tracking-tight text-blue-100 mb-1 font-serif">
                                SEKOLAH KEBANGSAAN TANAH KEBUN
                            </h1>
                            <p className="text-sm md:text-base text-blue-200 mb-4 font-light">
                                34200 Parit Buntar, Perak Darul Ridzuan.
                            </p>
                            <div className="h-px w-32 md:w-full bg-blue-500/50 mb-4"></div>
                            <h2 className="text-xl md:text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-500 uppercase tracking-widest">
                                SISTEM E-TEMPAH BILIK KHAS
                            </h2>
                        </div>
                    </div>
                </header>
            );
        };

        const BookingModal = ({ isOpen, onClose, onConfirm, selectedDate, selectedSlot, selectedRoom, dayName, existingBooking, isLoading = false }) => {
            const [teacher, setTeacher] = useState('');
            const [cls, setCls] = useState('');
            const [subject, setSubject] = useState('');
            const [error, setError] = useState('');

            if (!isOpen) return null;

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!teacher || !cls || !subject) {
                    setError('Sila lengkapkan semua maklumat.');
                    return;
                }
                const yyyy = selectedDate.getFullYear();
                const mm = String(selectedDate.getMonth() + 1).padStart(2, '0');
                const dd = String(selectedDate.getDate()).padStart(2, '0');
                const dateStr = `${yyyy}-${mm}-${dd}`;

                onConfirm({
                    room: selectedRoom,
                    teacherName: teacher,
                    className: cls,
                    subject: subject,
                    timeSlot: selectedSlot,
                    date: dateStr,
                    dayOfWeek: dayName
                });
            };

            if (existingBooking) {
                return (
                    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4">
                        <div className="bg-slate-800 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md p-6 relative">
                            <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-white">
                                <X size={24} />
                            </button>
                            <div className="flex flex-col items-center text-center">
                                <div className="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center text-red-500 mb-4">
                                    <AlertTriangle size={24} />
                                </div>
                                <h3 className="text-xl font-bold text-white mb-2">Slot Telah Ditempah</h3>
                                <p className="text-slate-300 mb-6">
                                    Slot ini telah ditempah oleh <br/>
                                    <span className="font-semibold text-yellow-400">{existingBooking.teacherName}</span><br/>
                                    untuk kelas <span className="font-semibold">{existingBooking.className}</span>.
                                </p>
                                <button onClick={onClose} className="px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
                                    Tutup
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 animate-in fade-in duration-200">
                    <div className="bg-white text-slate-900 rounded-xl shadow-2xl w-full max-w-lg overflow-hidden">
                        <div className="bg-blue-600 px-6 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-2 text-white">
                                <CalendarPlus size={20} />
                                <h2 className="text-lg font-bold">Tempah Slot: {selectedRoom}</h2>
                            </div>
                            {!isLoading && (
                                <button onClick={onClose} className="text-blue-100 hover:text-white transition-colors">
                                    <X size={24} />
                                </button>
                            )}
                        </div>
                        <div className="px-6 py-4 bg-blue-50 border-b border-blue-100">
                            <div className="flex justify-between text-sm text-blue-900 font-medium">
                                <span>{dayName}, {format(selectedDate, 'dd/MM/yyyy')}</span>
                                <span>{selectedSlot}</span>
                            </div>
                        </div>
                        <form onSubmit={handleSubmit} className="p-6 space-y-4">
                            {error && (
                                <div className="p-3 bg-red-100 text-red-700 text-sm rounded-lg flex items-center gap-2">
                                    <AlertTriangle size={16} /> {error}
                                </div>
                            )}
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-1">Nama Guru</label>
                                <select value={teacher} onChange={(e) => setTeacher(e.target.value)} disabled={isLoading} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-500">
                                    <option value="">-- Pilih Guru --</option>
                                    {TEACHERS.map((t) => <option key={t.name} value={t.name}>{t.name}</option>)}
                                </select>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Kelas</label>
                                    <select value={cls} onChange={(e) => setCls(e.target.value)} disabled={isLoading} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-500">
                                        <option value="">-- Pilih Kelas --</option>
                                        {CLASSES.map((c) => <option key={c.name} value={c.name}>{c.name}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold text-slate-700 mb-1">Subjek</label>
                                    <select value={subject} onChange={(e) => setSubject(e.target.value)} disabled={isLoading} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-500">
                                        <option value="">-- Pilih Subjek --</option>
                                        {SUBJECTS.map((s) => <option key={s.code} value={s.code}>{s.code}</option>)}
                                    </select>
                                </div>
                            </div>
                            <div className="pt-4 flex justify-end gap-3">
                                <button type="button" onClick={onClose} disabled={isLoading} className="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors font-medium disabled:opacity-50">
                                    Batal
                                </button>
                                <button type="submit" disabled={isLoading} className="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-md transition-all transform active:scale-95 font-bold disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2">
                                    {isLoading && <Loader2 size={18} className="animate-spin" />}
                                    {isLoading ? 'Sedang Memproses...' : 'Sahkan Tempahan'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const getTeacherColorClass = (name) => {
            const colors = [
                'bg-red-600/90 border-red-400 hover:bg-red-600', 'bg-orange-600/90 border-orange-400 hover:bg-orange-600',
                'bg-amber-600/90 border-amber-400 hover:bg-amber-600', 'bg-yellow-600/90 border-yellow-400 hover:bg-yellow-600',
                'bg-lime-600/90 border-lime-400 hover:bg-lime-600', 'bg-green-600/90 border-green-400 hover:bg-green-600',
                'bg-emerald-600/90 border-emerald-400 hover:bg-emerald-600', 'bg-teal-600/90 border-teal-400 hover:bg-teal-600',
                'bg-cyan-600/90 border-cyan-400 hover:bg-cyan-600', 'bg-sky-600/90 border-sky-400 hover:bg-sky-600',
                'bg-blue-600/90 border-blue-400 hover:bg-blue-600', 'bg-indigo-600/90 border-indigo-400 hover:bg-indigo-600',
                'bg-violet-600/90 border-violet-400 hover:bg-violet-600', 'bg-purple-600/90 border-purple-400 hover:bg-purple-600',
                'bg-fuchsia-600/90 border-fuchsia-400 hover:bg-fuchsia-600', 'bg-pink-600/90 border-pink-400 hover:bg-pink-600',
                'bg-rose-600/90 border-rose-400 hover:bg-rose-600', 'bg-slate-600/90 border-slate-400 hover:bg-slate-600',
            ];
            let hash = 0;
            for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
            return colors[Math.abs(hash) % colors.length];
        };

        const Timetable = ({ bookings, weekStart, selectedRoom, onSlotClick, isBookingEnabled }) => {
            const days = [
                { label: 'ISNIN', offset: 0 }, { label: 'SELASA', offset: 1 }, { label: 'RABU', offset: 2 },
                { label: 'KHAMIS', offset: 3 }, { label: 'JUMAAT', offset: 4 },
            ];
            const getBooking = (date, slotLabel) => {
                return bookings.find(b => b.room === selectedRoom && b.timeSlot === slotLabel && isSameDay(new Date(b.date), date));
            };

            return (
                <div className="overflow-x-auto pb-4">
                    <div className="min-w-[1000px] border border-slate-700 rounded-lg overflow-hidden shadow-xl">
                        <div className="grid grid-cols-6 bg-slate-800 text-white text-center border-b border-slate-600">
                            <div className="p-4 font-bold border-r border-slate-600 flex items-center justify-center bg-slate-900">MASA / HARI</div>
                            {days.map((day) => {
                                const date = addDays(weekStart, day.offset);
                                return (
                                    <div key={day.label} className="p-3 font-semibold border-r border-slate-600 last:border-r-0">
                                        <div className="text-yellow-400 text-lg">{day.label}</div>
                                        <div className="text-slate-400 text-xs mt-1">{format(date, 'dd/MM/yyyy')}</div>
                                    </div>
                                );
                            })}
                        </div>
                        <div className="bg-slate-800/50">
                            {TIME_SLOTS.map((slot, index) => (
                                <div key={slot.id} className={`grid grid-cols-6 border-b border-slate-700 ${index % 2 === 0 ? 'bg-slate-800/30' : 'bg-slate-800/10'}`}>
                                    <div className="p-3 border-r border-slate-600 text-sm font-mono text-blue-200 flex items-center justify-center font-bold">{slot.label}</div>
                                    {days.map((day) => {
                                        const currentDate = addDays(weekStart, day.offset);
                                        const booking = getBooking(currentDate, slot.label);
                                        if (slot.label.includes('REHAT')) {
                                            return <div key={`${day.label}-${slot.id}`} className="p-2 border-r border-slate-700 bg-gray-900/50 flex items-center justify-center text-gray-500 text-xs italic">REHAT</div>;
                                        }
                                        const teacherColorClass = booking ? getTeacherColorClass(booking.teacherName) : '';
                                        return (
                                            <div key={`${day.label}-${slot.id}`} 
                                                className={`relative p-2 border-r border-slate-600 min-h-[80px] transition-all duration-200 flex flex-col justify-center items-center text-center cursor-pointer group
                                                    ${booking ? `${teacherColorClass} border-l-4 shadow-md` : isBookingEnabled ? 'hover:bg-white/5' : 'opacity-50 cursor-not-allowed hover:bg-red-900/10'}`}
                                                onClick={() => { if (booking || isBookingEnabled) onSlotClick(currentDate, slot.label, day.label); }}>
                                                {booking ? (
                                                    <div className="w-full h-full flex flex-col justify-center animate-in zoom-in duration-300">
                                                        <span className="text-white font-black text-xs mb-1 line-clamp-1 drop-shadow-md tracking-wide">{booking.className}</span>
                                                        <span className="text-white/90 font-medium text-[10px] leading-tight line-clamp-2 drop-shadow-sm mb-1">{booking.teacherName}</span>
                                                        <span className="inline-block bg-black/40 backdrop-blur-sm text-white text-[9px] px-2 py-0.5 rounded-full shadow-sm border border-white/20 self-center">{booking.subject}</span>
                                                    </div>
                                                ) : (
                                                    <div className="opacity-0 group-hover:opacity-100 text-slate-500">
                                                        {isBookingEnabled ? <span className="text-xs text-green-400 font-medium">+ Tempah</span> : <Lock size={14} className="mx-auto" />}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [currentWeekStart, setCurrentWeekStart] = useState(() => startOfWeek(new Date(), { weekStartsOn: 1 }));
            const [selectedRoom, setSelectedRoom] = useState(RoomType.MAKMAL_KOMPUTER);
            const [bookings, setBookings] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [modalData, setModalData] = useState(null);

            const fetchBookings = useCallback(async () => {
                setIsLoading(true);
                const data = await getBookings();
                setBookings(data);
                setIsLoading(false);
            }, []);

            useEffect(() => { fetchBookings(); }, [fetchBookings]);

            const handlePreviousWeek = () => setCurrentWeekStart(prev => subWeeks(prev, 1));
            const handleNextWeek = () => setCurrentWeekStart(prev => addWeeks(prev, 1));

            const today = startOfToday();
            const isViewedWeekCurrent = isSameWeek(currentWeekStart, today, { weekStartsOn: 1 });
            const canBook = isViewedWeekCurrent;

            const handleSlotClick = (date, slot, day) => {
                const existing = bookings.find(b => b.room === selectedRoom && b.timeSlot === slot && b.date === format(date, 'yyyy-MM-dd'));
                if (existing) {
                    setModalData({ date, slot, day, existing });
                    setIsModalOpen(true);
                    return;
                }
                if (!canBook) {
                    alert("Maaf, tempahan hanya dibuka untuk minggu semasa bermula hari Isnin.");
                    return;
                }
                setModalData({ date, slot, day });
                setIsModalOpen(true);
            };

            const handleConfirmBooking = async (newBookingData) => {
                setIsSubmitting(true);
                const newBooking = {
                    ...newBookingData,
                    id: Date.now().toString(),
                    createdAt: Date.now(),
                    weekId: format(currentWeekStart, 'yyyy-ww'),
                };
                const success = await saveBooking(newBooking);
                if (success) {
                    await fetchBookings();
                    setIsModalOpen(false);
                } else {
                    alert("Gagal menyimpan tempahan.");
                }
                setIsSubmitting(false);
            };

            const getRoomIcon = (room) => {
                switch (room) {
                    case RoomType.MAKMAL_KOMPUTER: return <Monitor size={20} />;
                    case RoomType.BILIK_TAYANGAN: return <Film size={20} />;
                    case RoomType.BILIK_MESYUARAT: return <Users size={20} />;
                }
            };

            return (
                <div className="min-h-screen bg-[#0b1120] font-sans pb-12">
                    <Header />
                    <main className="container mx-auto px-4 mt-8">
                        <div className="flex flex-col md:flex-row justify-between items-center gap-6 mb-8">
                            <div className="flex bg-slate-800 p-1 rounded-xl shadow-lg border border-slate-700 w-full md:w-auto overflow-x-auto">
                                {ROOMS.map((room) => (
                                    <button key={room} onClick={() => setSelectedRoom(room)} className={`flex items-center gap-2 px-6 py-3 rounded-lg text-sm font-bold transition-all whitespace-nowrap ${selectedRoom === room ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400 hover:text-white hover:bg-slate-700'}`}>
                                        {getRoomIcon(room)} {room}
                                    </button>
                                ))}
                            </div>
                            <div className="flex items-center bg-slate-800 rounded-lg p-1 border border-slate-700 shadow-lg">
                                <button onClick={handlePreviousWeek} className="p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-md transition-colors"><ChevronLeft size={24} /></button>
                                <div className="px-6 text-center">
                                    <span className="block text-xs text-slate-400 font-bold uppercase tracking-wider">Minggu</span>
                                    <span className="text-white font-mono font-bold">{format(currentWeekStart, 'dd MMM')} - {format(addWeeks(currentWeekStart, 1), 'dd MMM yyyy')}</span>
                                </div>
                                <button onClick={handleNextWeek} className="p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-md transition-colors"><ChevronRight size={24} /></button>
                            </div>
                        </div>
                        <div className="bg-blue-900/30 border border-blue-800/50 rounded-lg p-4 mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-start gap-3">
                                <Database className="text-blue-400 mt-1 flex-shrink-0" size={20} />
                                <div>
                                    <p className="text-blue-200 text-sm">Sistem disambungkan ke Google Cloud Database. Data akan diselaraskan untuk semua guru secara masa nyata.</p>
                                    {!isViewedWeekCurrent && <p className="text-yellow-500 text-xs font-bold mt-2 uppercase tracking-wide">MOD LIHAT SAHAJA (Bukan Minggu Semasa)</p>}
                                </div>
                            </div>
                            <button onClick={fetchBookings} disabled={isLoading} className="flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg text-sm transition-colors border border-slate-700">
                                {isLoading ? <><Loader2 size={16} className="animate-spin" /> Mengemaskini...</> : <><Database size={16} /> Kemaskini Data</>}
                            </button>
                        </div>
                        {isLoading && bookings.length === 0 ? (
                            <div className="flex flex-col items-center justify-center py-20 text-slate-500"><Loader2 size={48} className="animate-spin text-blue-500 mb-4" /><p>Sedang memuat turun jadual...</p></div>
                        ) : (
                            <Timetable bookings={bookings} weekStart={currentWeekStart} selectedRoom={selectedRoom} onSlotClick={handleSlotClick} isBookingEnabled={canBook} />
                        )}
                        <div className="mt-8 text-center text-slate-600 text-sm">&copy; {new Date().getFullYear()} Sekolah Kebangsaan Tanah Kebun. Hak Cipta Terpelihara.</div>
                    </main>
                    {modalData && (
                        <BookingModal isOpen={isModalOpen} onClose={() => !isSubmitting && setIsModalOpen(false)} onConfirm={handleConfirmBooking} selectedDate={modalData.date} selectedSlot={modalData.slot} selectedRoom={selectedRoom} dayName={modalData.day} existingBooking={modalData.existing} isLoading={isSubmitting} />
                    )}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
